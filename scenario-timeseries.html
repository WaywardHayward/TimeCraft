<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeCraft - Scenario Time Series Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">TimeCraft</h1>
            <p class="text-xl text-gray-600">Scenario-Based Time Series Generator</p>
            <p class="text-sm text-gray-500 mt-2">Generate aggregate time series data from your scenario descriptions</p>
        </div>

        <!-- Input Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Describe Your Scenario</h2>
            <div class="mb-4">
                <label for="scenarioText" class="block text-sm font-medium text-gray-700 mb-2">
                    Scenario Description
                </label>
                <textarea 
                    id="scenarioText" 
                    rows="4" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Example: A smart factory monitoring system tracking temperature, pressure, and vibration sensors across different production lines during a 24-hour manufacturing cycle..."
                ></textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label for="numTags" class="block text-sm font-medium text-gray-700 mb-2">Number of Tags</label>
                    <select id="numTags" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="3">3 Tags</option>
                        <option value="4">4 Tags</option>
                        <option value="5" selected>5 Tags</option>
                        <option value="6">6 Tags</option>
                    </select>
                </div>
                <div>
                    <label for="dataLength" class="block text-sm font-medium text-gray-700 mb-2">Data Points</label>
                    <select id="dataLength" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="24">24 Hours</option>
                        <option value="48">48 Hours</option>
                        <option value="168" selected>1 Week (168 Hours)</option>
                        <option value="720">1 Month (720 Hours)</option>
                    </select>
                </div>
                <div>
                    <label for="frequency" class="block text-sm font-medium text-gray-700 mb-2">Frequency</label>
                    <select id="frequency" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="hourly" selected>Hourly</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-4">
                <button 
                    id="generateBtn" 
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    onclick="generateTimeSeries()"
                >
                    Generate Time Series
                </button>
                <button 
                    id="exportBtn" 
                    class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    onclick="exportToCSV()"
                    disabled
                >
                    Export CSV
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="bg-white rounded-lg shadow-md p-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-gray-800">Generated Time Series</h2>
                <div class="text-sm text-gray-600">
                    <span id="generationInfo"></span>
                </div>
            </div>
            
            <!-- Chart -->
            <div class="chart-container mb-6">
                <canvas id="timeSeriesChart"></canvas>
            </div>

            <!-- Statistics -->
            <div id="statisticsSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <!-- Statistics will be populated here -->
            </div>

            <!-- Data Preview -->
            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Data Preview</h3>
                <div class="bg-gray-50 rounded-lg p-4 max-h-64 overflow-y-auto">
                    <pre id="dataPreview" class="text-sm text-gray-700"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;
        let chart = null;

        // Mock time series generation functions
        function generateSinePattern(length, baseValue, amplitude, frequency, phase, noise) {
            const data = [];
            for (let i = 0; i < length; i++) {
                const value = baseValue + Math.sin(i * frequency + phase) * amplitude + (Math.random() - 0.5) * noise;
                data.push(Math.round(value * 100) / 100);
            }
            return data;
        }

        function generateLinearPattern(length, baseValue, slope, noise) {
            const data = [];
            for (let i = 0; i < length; i++) {
                const value = baseValue + i * slope + (Math.random() - 0.5) * noise;
                data.push(Math.round(value * 100) / 100);
            }
            return data;
        }

        function generateSeasonalPattern(length, baseValue, amplitude, period, noise) {
            const data = [];
            for (let i = 0; i < length; i++) {
                const seasonal = Math.sin(2 * Math.PI * i / period) * amplitude;
                const trend = baseValue + i * 0.01;
                const value = trend + seasonal + (Math.random() - 0.5) * noise;
                data.push(Math.round(value * 100) / 100);
            }
            return data;
        }

        function generateRandomWalkPattern(length, startValue, stepSize) {
            const data = [startValue];
            for (let i = 1; i < length; i++) {
                const step = (Math.random() - 0.5) * stepSize;
                const value = data[i-1] + step;
                data.push(Math.round(value * 100) / 100);
            }
            return data;
        }

        function generateTagNamesFromScenario(scenario, numTags) {
            // Simple tag generation based on common keywords
            const keywordMapping = {
                'temperature': ['Temperature_Sensor_1', 'Temperature_Sensor_2', 'Ambient_Temperature'],
                'pressure': ['Pressure_Gauge_1', 'Pressure_Gauge_2', 'System_Pressure'],
                'vibration': ['Vibration_X', 'Vibration_Y', 'Vibration_Z'],
                'factory': ['Production_Rate', 'Machine_Efficiency', 'Power_Consumption'],
                'energy': ['Power_Output', 'Voltage', 'Current'],
                'sensor': ['Sensor_A', 'Sensor_B', 'Sensor_C'],
                'monitoring': ['CPU_Usage', 'Memory_Usage', 'Network_Traffic'],
                'financial': ['Stock_Price', 'Trading_Volume', 'Market_Index'],
                'weather': ['Temperature', 'Humidity', 'Wind_Speed'],
                'traffic': ['Vehicle_Count', 'Speed_Average', 'Congestion_Level']
            };

            const tags = [];
            const lowerScenario = scenario.toLowerCase();
            
            // Find matching keywords and generate appropriate tags
            for (const [keyword, tagList] of Object.entries(keywordMapping)) {
                if (lowerScenario.includes(keyword)) {
                    tags.push(...tagList);
                    if (tags.length >= numTags) break;
                }
            }

            // Fill remaining slots with generic tags
            while (tags.length < numTags) {
                tags.push(`Tag_${tags.length + 1}`);
            }

            return tags.slice(0, numTags);
        }

        function generateMockTimeSeries() {
            const scenario = document.getElementById('scenarioText').value || 'Generic monitoring scenario';
            const numTags = parseInt(document.getElementById('numTags').value);
            const length = parseInt(document.getElementById('dataLength').value);
            const frequency = document.getElementById('frequency').value;

            // Generate tag names based on scenario
            const tagNames = generateTagNamesFromScenario(scenario, numTags);
            
            const timeSeriesData = {};
            const patterns = ['sine', 'linear', 'seasonal', 'randomwalk', 'mixed'];

            tagNames.forEach((tag, index) => {
                const pattern = patterns[index % patterns.length];
                let data;

                switch (pattern) {
                    case 'sine':
                        data = generateSinePattern(length, 50 + index * 20, 15, 0.1 + index * 0.05, index, 5);
                        break;
                    case 'linear':
                        data = generateLinearPattern(length, 30 + index * 15, 0.1 + index * 0.05, 3);
                        break;
                    case 'seasonal':
                        data = generateSeasonalPattern(length, 40 + index * 10, 20, 24, 4);
                        break;
                    case 'randomwalk':
                        data = generateRandomWalkPattern(length, 60 + index * 10, 2);
                        break;
                    default: // mixed
                        const base = generateSinePattern(length, 45 + index * 12, 10, 0.08, index, 2);
                        const trend = generateLinearPattern(length, 0, 0.05, 1);
                        data = base.map((val, i) => Math.round((val + trend[i]) * 100) / 100);
                }

                timeSeriesData[tag] = data;
            });

            return {
                scenario: scenario,
                tagNames: tagNames,
                length: length,
                frequency: frequency,
                timeSeries: timeSeriesData,
                timestamp: new Date().toISOString()
            };
        }

        function generateTimeSeries() {
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';

            // Simulate processing time
            setTimeout(() => {
                try {
                    currentData = generateMockTimeSeries();
                    displayResults();
                    document.getElementById('exportBtn').disabled = false;
                } catch (error) {
                    console.error('Error generating time series:', error);
                    alert('Error generating time series. Please try again.');
                } finally {
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'Generate Time Series';
                }
            }, 1000);
        }

        function displayResults() {
            if (!currentData) return;

            // Show results section
            document.getElementById('resultsSection').classList.remove('hidden');

            // Update generation info
            document.getElementById('generationInfo').textContent = 
                `${currentData.tagNames.length} tags, ${currentData.length} points (${currentData.frequency})`;

            // Create chart
            createChart();

            // Display statistics
            displayStatistics();

            // Display data preview
            displayDataPreview();

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function createChart() {
            const ctx = document.getElementById('timeSeriesChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (chart) {
                chart.destroy();
            }

            const colors = [
                '#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6',
                '#EC4899', '#06B6D4', '#84CC16', '#F97316', '#6366F1'
            ];

            const datasets = Object.entries(currentData.timeSeries).map(([tag, data], index) => ({
                label: tag,
                data: data,
                borderColor: colors[index % colors.length],
                backgroundColor: colors[index % colors.length] + '20',
                borderWidth: 2,
                fill: false,
                tension: 0.1
            }));

            const labels = Array.from({ length: currentData.length }, (_, i) => {
                if (currentData.frequency === 'hourly') {
                    return `H${i + 1}`;
                } else if (currentData.frequency === 'daily') {
                    return `D${i + 1}`;
                } else {
                    return `W${i + 1}`;
                }
            });

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Generated Time Series Data'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: `Time (${currentData.frequency})`
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function displayStatistics() {
            const statsSection = document.getElementById('statisticsSection');
            statsSection.innerHTML = '';

            Object.entries(currentData.timeSeries).forEach(([tag, data]) => {
                const mean = data.reduce((sum, val) => sum + val, 0) / data.length;
                const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / data.length;
                const stdDev = Math.sqrt(variance);
                const min = Math.min(...data);
                const max = Math.max(...data);

                const statCard = document.createElement('div');
                statCard.className = 'bg-gray-50 rounded-lg p-4';
                statCard.innerHTML = `
                    <h4 class="font-semibold text-gray-800 mb-2">${tag}</h4>
                    <div class="space-y-1 text-sm text-gray-600">
                        <div>Mean: ${mean.toFixed(2)}</div>
                        <div>Std Dev: ${stdDev.toFixed(2)}</div>
                        <div>Min: ${min.toFixed(2)}</div>
                        <div>Max: ${max.toFixed(2)}</div>
                    </div>
                `;
                statsSection.appendChild(statCard);
            });
        }

        function displayDataPreview() {
            const preview = document.getElementById('dataPreview');
            let previewText = 'Time\t' + currentData.tagNames.join('\t') + '\n';
            
            const maxPreviewRows = 10;
            for (let i = 0; i < Math.min(maxPreviewRows, currentData.length); i++) {
                const row = [i + 1].concat(
                    currentData.tagNames.map(tag => currentData.timeSeries[tag][i])
                );
                previewText += row.join('\t') + '\n';
            }
            
            if (currentData.length > maxPreviewRows) {
                previewText += '...\n';
                previewText += `(${currentData.length - maxPreviewRows} more rows)`;
            }
            
            preview.textContent = previewText;
        }

        function exportToCSV() {
            if (!currentData) return;

            let csvContent = 'Time,' + currentData.tagNames.join(',') + '\n';
            
            for (let i = 0; i < currentData.length; i++) {
                const row = [i + 1].concat(
                    currentData.tagNames.map(tag => currentData.timeSeries[tag][i])
                );
                csvContent += row.join(',') + '\n';
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `timeseries_${Date.now()}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Initialize with example scenario
        window.addEventListener('load', function() {
            document.getElementById('scenarioText').value = 
                'A smart factory monitoring system tracking temperature, pressure, and vibration sensors across different production lines during a 24-hour manufacturing cycle with automated quality control systems.';
        });
    </script>
</body>
</html>